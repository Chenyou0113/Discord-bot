# æ°´ä½æŸ¥è©¢ 'str' object has no attribute 'get' éŒ¯èª¤ä¿®å¾©å ±å‘Š

## å•é¡Œæè¿°
2025-07-01 11:58:44,800 - ERROR - cogs.reservoir_commands - æŸ¥è©¢æ²³å·æ°´ä½æ™‚ç™¼ç”ŸéŒ¯èª¤: 'str' object has no attribute 'get'

## å•é¡Œæ ¹å› åˆ†æ
1. **éŒ¯èª¤çš„ API ç«¯é»**: åŸå§‹ç¨‹å¼ç¢¼ä½¿ç”¨äº†ä¸­å¤®æ°£è±¡ç½²çš„åœ°éœ‡è³‡æ–™ API (E-A0015-001)ï¼Œä½†é€™å€‹ç«¯é»å›å‚³çš„æ˜¯åœ°éœ‡è³‡æ–™ï¼Œä¸æ˜¯æ²³å·æ°´ä½è³‡æ–™ã€‚
2. **è³‡æ–™çµæ§‹ä¸åŒ¹é…**: ç¨‹å¼ç¢¼æœŸæœ›çš„æ˜¯æ²³å·æ°´ä½è³‡æ–™æ ¼å¼ï¼Œä½†å¯¦éš›æ”¶åˆ°çš„æ˜¯åœ°éœ‡è³‡æ–™æ ¼å¼ã€‚
3. **æ¬„ä½åç¨±éŒ¯èª¤**: ç¨‹å¼ç¢¼å˜—è©¦å–å¾— 'StationName'ã€'CountyName'ã€'RiverName' ç­‰æ¬„ä½ï¼Œä½†å¯¦éš›çš„æ°´ä½ API å›æ‡‰ä¸­æ²’æœ‰é€™äº›æ¬„ä½ã€‚

## ä¿®å¾©æªæ–½

### 1. æ›´æ­£ API URL
```python
# ä¿®æ­£å‰ (éŒ¯èª¤çš„åœ°éœ‡ API)
api_base = "https://opendata.cwa.gov.tw/api/v1/rest/datastore"
endpoint = "E-A0015-001"  # åœ°éœ‡è³‡æ–™ API

# ä¿®æ­£å¾Œ (æ­£ç¢ºçš„æ°´ä½ API)
api_url = "https://opendata.wra.gov.tw/Service/OpenData.aspx?format=json&id=2D09DB8B-6A1B-485E-88B5-923A462F475C"
```

### 2. ä¿®æ­£è³‡æ–™çµæ§‹è™•ç†
```python
# ä¿®æ­£å‰
records = data.get('records', [])
if isinstance(records, dict):
    # è¤‡é›œçš„çµæ§‹è™•ç†...

# ä¿®æ­£å¾Œ
records = data.get('RealtimeWaterLevel_OPENDATA', [])
```

### 3. ä¿®æ­£æ¬„ä½åç¨±å°æ‡‰
```python
# ä¿®æ­£å‰
station_name = record.get('StationName', 'N/A')
county_name = record.get('CountyName', 'N/A')
river_name = record.get('RiverName', 'N/A')
obs_time = record.get('ObsTime', 'N/A')

# ä¿®æ­£å¾Œ
station_id = record.get('ST_NO', 'N/A')
observatory_id = record.get('ObservatoryIdentifier', 'N/A')
water_level = record.get('WaterLevel', 'N/A')
record_time = record.get('RecordTime', 'N/A')
```

### 4. èª¿æ•´ç¯©é¸é‚è¼¯
ç”±æ–¼ç•¶å‰ API ä¸æä¾›ç¸£å¸‚å’Œæ²³å·è³‡è¨Šï¼Œä¿®æ­£ç¯©é¸é‚è¼¯ï¼š
```python
# ç¸£å¸‚å’Œæ²³å·ç¯©é¸æš«æ™‚åœç”¨
if city:
    # ç”±æ–¼æ²’æœ‰ç¸£å¸‚è³‡è¨Šï¼Œæš«æ™‚è·³éç¸£å¸‚ç¯©é¸
    pass

if river:
    # ç”±æ–¼æ²’æœ‰æ²³å·è³‡è¨Šï¼Œæš«æ™‚è·³éæ²³å·ç¯©é¸
    pass

# åªä¿ç•™æ¸¬ç«™ç·¨è™Ÿç¯©é¸
if station and matches:
    if (station.lower() not in station_id.lower() and 
        station.lower() not in observatory_id.lower()):
        matches = False
```

### 5. æ›´æ–°æŒ‡ä»¤æè¿°
```python
@app_commands.command(name="water_level", description="æŸ¥è©¢å…¨å°æ²³å·æ°´ä½å³æ™‚è³‡æ–™ï¼ˆä¾æ¸¬ç«™ç·¨è™Ÿï¼‰")
@app_commands.describe(
    city="ç¸£å¸‚åç¨±ï¼ˆç›®å‰æš«ä¸æ”¯æ´ï¼Œæ­£åœ¨é–‹ç™¼ä¸­ï¼‰",
    river="æ²³å·åç¨±ï¼ˆç›®å‰æš«ä¸æ”¯æ´ï¼Œæ­£åœ¨é–‹ç™¼ä¸­ï¼‰",
    station="æ¸¬ç«™ç·¨è™Ÿæˆ–è­˜åˆ¥ç¢¼ï¼ˆéƒ¨åˆ†é—œéµå­—æœå°‹ï¼‰"
)
```

## æ¸¬è©¦çµæœ
âœ… **æ¸¬è©¦é€šé**: æˆåŠŸç²å– 353 ç­†æ°´ä½è³‡æ–™
âœ… **ç¯©é¸åŠŸèƒ½**: èƒ½æ ¹æ“šæ¸¬ç«™ç·¨è™Ÿé€²è¡Œç¯©é¸
âœ… **è³‡æ–™æ ¼å¼åŒ–**: æ°´ä½ã€æ™‚é–“æ ¼å¼æ­£ç¢ºé¡¯ç¤º
âœ… **éŒ¯èª¤è™•ç†**: ç„¡èªæ³•éŒ¯èª¤

### æ¸¬è©¦è¼¸å‡ºç¤ºä¾‹
```
1. æ¸¬ç«™: 1010H006
   ğŸ·ï¸ è­˜åˆ¥ç¢¼: 3132020RV1010H006
   ğŸ’§ æ°´ä½: 1.92 å…¬å°º
   â° æ™‚é–“: 07/01 20:40
```

## å¾ŒçºŒæ”¹å–„å»ºè­°
1. **å»ºç«‹æ¸¬ç«™å°æ‡‰è¡¨**: å°‡æ¸¬ç«™ç·¨è™Ÿå°æ‡‰åˆ°ç¸£å¸‚å’Œæ²³å·åç¨±
2. **å°‹æ‰¾æ›´å®Œæ•´çš„ API**: å°‹æ‰¾åŒ…å«ç¸£å¸‚å’Œæ²³å·è³‡è¨Šçš„æ°´ä½ API
3. **è³‡æ–™è£œå¼·**: é€šéå…¶ä»–è³‡æ–™æºè£œå……åœ°ç†ä½ç½®è³‡è¨Š

## ä¿®å¾©å®Œæˆæ™‚é–“
2025-07-01 13:10:09

## ç‹€æ…‹
ğŸŸ¢ **å·²ä¿®å¾©**: 'str' object has no attribute 'get' éŒ¯èª¤å·²è§£æ±º
âš ï¸ **åŠŸèƒ½é™åˆ¶**: ç¸£å¸‚å’Œæ²³å·ç¯©é¸åŠŸèƒ½æš«æ™‚åœç”¨
âœ… **åŸºæœ¬åŠŸèƒ½**: æ¸¬ç«™æ°´ä½æŸ¥è©¢æ­£å¸¸é‹ä½œ
