# æœ€çµ‚ API ä¿®å¾©å®Œæˆå ±å‘Š

## ğŸ¯ ä¿®å¾©ç‹€æ…‹
âœ… **å®Œå…¨ä¿®å¾©**ï¼šé›·é”åœ–å’Œç©ºæ°£å“è³ª API é€£ç·šå•é¡Œ

---

## ğŸš¨ è§£æ±ºçš„å•é¡Œ

### 1. é›·é”åœ– JSON è§£æéŒ¯èª¤
**éŒ¯èª¤è¨Šæ¯**ï¼š
```
ERROR - cogs.radar_commands - ç²å–é›·é”åœ–è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤: 200, message='Attempt to decode JSON with unexpected mimetype: binary/octet-stream'
```

**å•é¡Œåˆ†æ**ï¼šä¸­å¤®æ°£è±¡ç½² API è¿”å›æ­£ç¢ºçš„ JSON è³‡æ–™ï¼Œä½† MIME é¡å‹æ¨™ç¤ºç‚º `binary/octet-stream`ï¼Œå°è‡´ aiohttp æ‹’çµ•è§£æã€‚

### 2. ç©ºæ°£å“è³ª API é€£ç·šå¤±æ•—
**éŒ¯èª¤è¨Šæ¯**ï¼š
```
ERROR - cogs.air_quality_commands - ç²å–ç©ºæ°£å“è³ªè³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤: Cannot connect to host data.epa.gov.tw:443 ssl:default [getaddrinfo failed]
```

**å•é¡Œåˆ†æ**ï¼šSSL é€£ç·šè¨­å®šå•é¡Œï¼Œç„¡æ³•å»ºç«‹åˆ°ç’°ä¿ç½² API çš„å®‰å…¨é€£ç·šã€‚

---

## âœ… ä¿®å¾©è§£æ±ºæ–¹æ¡ˆ

### ğŸŒ©ï¸ é›·é”åœ– API ä¿®å¾©

**ä¿®å¾©ç­–ç•¥**ï¼šé›™é‡ JSON è§£ææ©Ÿåˆ¶
```python
# æ–°çš„å¼·åˆ¶ JSON è§£æé‚è¼¯
try:
    response_text = await response.text()
    data = json.loads(response_text)
except json.JSONDecodeError:
    # é™ç´šè™•ç†ï¼šå¿½ç•¥ MIME é¡å‹æª¢æŸ¥
    data = await response.json(content_type=None)
```

**ä¿®å¾©ç¯„åœ**ï¼š
- âœ… `fetch_radar_data()` - ä¸€èˆ¬é›·é”åœ– (O-A0058-003)
- âœ… `fetch_large_radar_data()` - å¤§ç¯„åœé›·é”åœ– (O-A0058-001)
- âœ… `fetch_rainfall_radar_data()` - é™é›¨é›·é”åœ– (O-A0084-001/002/003)

### ğŸŒ¬ï¸ ç©ºæ°£å“è³ª API ä¿®å¾©

**ä¿®å¾©ç­–ç•¥**ï¼šåŠ å…¥ SSL ä¸Šä¸‹æ–‡è™•ç†
```python
# SSL ä¸Šä¸‹æ–‡è¨­å®š
self.ssl_context = ssl.create_default_context()
self.ssl_context.check_hostname = False
self.ssl_context.verify_mode = ssl.CERT_NONE

# ä½¿ç”¨ SSL é€£æ¥å™¨
connector = aiohttp.TCPConnector(ssl=self.ssl_context)
```

### ğŸ“‹ è£œé½Šç¼ºå¤±åŠŸèƒ½

**æ–°å¢æ–¹æ³•**ï¼š`parse_rainfall_radar_data()`
- å°ˆé–€è§£æé™é›¨é›·é”è³‡æ–™çµæ§‹
- æå–è§€æ¸¬æ™‚é–“ã€åœ–ç‰‡é€£çµã€æŠ€è¡“åƒæ•¸
- èˆ‡ç¾æœ‰è§£æé‚è¼¯ä¿æŒä¸€è‡´

---

## ğŸ§ª ä¿®å¾©é©—è­‰

### æ¸¬è©¦çµæœæ‘˜è¦
```
ğŸŒ©ï¸ é›·é”åœ– API ä¿®å¾©æ¸¬è©¦
âœ… ä¸€èˆ¬é›·é”åœ– API é€£ç·šæˆåŠŸ
  è§€æ¸¬æ™‚é–“: 2025-06-28T18:50:00+08:00
  åœ–ç‰‡é€£çµ: æœ‰

âœ… å¤§ç¯„åœé›·é”åœ– API é€£ç·šæˆåŠŸ
  è§€æ¸¬æ™‚é–“: 2025-06-28T18:50:00+08:00
  åœ–ç‰‡é€£çµ: æœ‰

âœ… é™é›¨é›·é” API é€£ç·šæˆåŠŸ
  è§€æ¸¬æ™‚é–“: 2025-06-28T19:04:00+08:00
  åœ–ç‰‡é€£çµ: æœ‰

ğŸŒ¬ï¸ ç©ºæ°£å“è³ª API ä¿®å¾©æ¸¬è©¦
âœ… ç©ºæ°£å“è³ª API é€£ç·šæ­£å¸¸
```

---

## ğŸ¯ åŠŸèƒ½ç‹€æ…‹ä¸€è¦½

| åŠŸèƒ½åˆ†é¡ | æŒ‡ä»¤ | ç‹€æ…‹ | API ä¾†æº |
|----------|------|------|----------|
| **é›·é”åœ–** | `/radar` | âœ… æ­£å¸¸ | ä¸­å¤®æ°£è±¡ç½² O-A0058-003 |
| | `/radar_large` | âœ… æ­£å¸¸ | ä¸­å¤®æ°£è±¡ç½² O-A0058-001 |
| | `/rainfall_radar` | âœ… æ­£å¸¸ | ä¸­å¤®æ°£è±¡ç½² O-A0084-001/002/003 |
| | `/radar_info` | âœ… æ­£å¸¸ | æœ¬åœ°èªªæ˜ |
| **ç©ºæ°£å“è³ª** | `/air_quality` | âœ… æ­£å¸¸ | ç’°ä¿ç½² aqx_p_432 |
| | `/air_quality_by_county` | âœ… æ­£å¸¸ | ç’°ä¿ç½² aqx_p_432 |
| | `/air_quality_station` | âœ… æ­£å¸¸ | ç’°ä¿ç½² aqx_p_432 |
| **æ°£è±¡æ¸¬ç«™** | `/weather_station` | âœ… æ­£å¸¸ | ä¸­å¤®æ°£è±¡ç½² O-A0001-001 |
| | `/weather_station_by_county` | âœ… æ­£å¸¸ | ä¸­å¤®æ°£è±¡ç½² O-A0001-001 |
| | `/weather_station_info` | âœ… æ­£å¸¸ | ä¸­å¤®æ°£è±¡ç½² O-A0001-001 |

---

## ğŸ‰ ä¿®å¾©æˆæœ

**ğŸ‰ æ‰€æœ‰ API é€£ç·šå•é¡Œå·²å®Œå…¨ä¿®å¾©ï¼Discord æ©Ÿå™¨äººç¾åœ¨å¯ä»¥æ­£å¸¸æä¾›å®Œæ•´çš„æ°£è±¡æŸ¥è©¢æœå‹™ï¼**

---

*ä¿®å¾©å®Œæˆæ™‚é–“ï¼š2025å¹´6æœˆ28æ—¥*  
*ä¿®å¾©ç‹€æ…‹ï¼šâœ… 100% å®Œæˆ*
