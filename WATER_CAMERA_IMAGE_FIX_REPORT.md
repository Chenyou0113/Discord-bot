# æ°´åˆ©ç›£è¦–å™¨åœ–ç‰‡é¡¯ç¤ºä¿®å¾©å ±å‘Š

## å•é¡Œæè¿°
ç”¨æˆ¶åæ˜  Discord æ©Ÿå™¨äººçš„ `/water_cameras` æŒ‡ä»¤ç„¡æ³•æ­£å¸¸é¡¯ç¤ºç›£è¦–å™¨åœ–ç‰‡ã€‚

## å•é¡Œåˆ†æ

### 1. å¯èƒ½çš„åŸå› 
- **URL æ ¼å¼å•é¡Œ**: API è¿”å›çš„åœ–ç‰‡ URL å¯èƒ½ä¸æ˜¯å®Œæ•´çš„ HTTPS URL
- **Discord Embed é™åˆ¶**: Discord å°åœ–ç‰‡ URL æœ‰ç‰¹å®šè¦æ±‚
- **API è³‡æ–™å“è³ª**: éƒ¨åˆ†ç›£æ§é»å¯èƒ½æ²’æœ‰æœ‰æ•ˆçš„åœ–ç‰‡ URL
- **ç¶²è·¯é€£ç·šå•é¡Œ**: åœ–ç‰‡ä¼ºæœå™¨å¯èƒ½ç„¡æ³•è¨ªå•

### 2. å¯¦æ–½çš„ä¿®å¾©

#### 2.1 æ”¹é€² URL è™•ç†é‚è¼¯
```python
def format_water_image_info(self, image_data):
    # è™•ç†å½±åƒ URL - ä¿®å¾©ç‰ˆæœ¬
    processed_image_url = "N/A"
    if image_url and image_url.strip():
        processed_image_url = image_url.strip()
        # ç¢ºä¿ URL æ ¼å¼æ­£ç¢º
        if not processed_image_url.startswith(('http://', 'https://')):
            if processed_image_url.startswith('//'):
                processed_image_url = 'https:' + processed_image_url
            elif processed_image_url.startswith('/'):
                processed_image_url = 'https://opendata.wra.gov.tw' + processed_image_url
            else:
                # å¦‚æœæ˜¯ç›¸å°è·¯å¾‘ï¼ŒåŠ ä¸ŠåŸºç¤ URL
                processed_image_url = 'https://opendata.wra.gov.tw/' + processed_image_url
```

#### 2.2 å¢å¼· Discord Embed é¡¯ç¤º
```python
def create_embed(self, index: int):
    # é¡¯ç¤ºå½±åƒ - æ”¹é€²åœ–ç‰‡é¡¯ç¤ºé‚è¼¯
    image_url = info.get('image_url', '')
    if image_url and image_url != 'N/A' and image_url.strip():
        try:
            # ç¢ºä¿ URL æ ¼å¼æ­£ç¢º
            if not image_url.startswith(('http://', 'https://')):
                if image_url.startswith('//'):
                    image_url = 'https:' + image_url
                elif not image_url.startswith('/'):
                    image_url = 'https://' + image_url
            
            embed.set_image(url=image_url)
            
            # æ·»åŠ å½±åƒè³‡è¨Šæ¬„ä½
            embed.add_field(
                name="ğŸ“¸ å½±åƒè³‡è¨Š",
                value=f"[æŸ¥çœ‹åŸå§‹å½±åƒ]({image_url})\n"
                      f"ğŸ“· æ”å½±æ©Ÿ: {info.get('camera_name', 'N/A')}",
                inline=False
            )
            
        except Exception as e:
            logger.error(f"è¨­å®šå½±åƒ URL æ™‚ç™¼ç”ŸéŒ¯èª¤: {str(e)}")
```

## ä¿®å¾©å¾Œçš„åŠŸèƒ½æ”¹é€²

### 1. æ›´å¥½çš„éŒ¯èª¤è™•ç†
- ç•¶åœ–ç‰‡ç„¡æ³•è¼‰å…¥æ™‚ï¼Œé¡¯ç¤ºæ¸…æ¥šçš„éŒ¯èª¤è¨Šæ¯
- æä¾›åº§æ¨™ä½ç½®ç­‰æ›¿ä»£è³‡è¨Š
- åŒ…å«åŸå§‹å½±åƒé€£çµä¾›ç”¨æˆ¶é»æ“ŠæŸ¥çœ‹

### 2. å¢å¼·çš„è³‡è¨Šé¡¯ç¤º
- æ”å½±æ©Ÿåç¨±
- å¯é»æ“Šçš„åŸå§‹å½±åƒé€£çµ
- ç›£æ§é»åº§æ¨™ä½ç½®
- æ›´è©³ç´°çš„ç‹€æ…‹è³‡è¨Š

### 3. æ”¹é€²çš„ URL è™•ç†
- è‡ªå‹•è£œå…¨ä¸å®Œæ•´çš„ URL
- è™•ç†ç›¸å°è·¯å¾‘å’Œçµ•å°è·¯å¾‘
- ç¢ºä¿ HTTPS å”è­°

## æ¸¬è©¦é©—è­‰

### 1. åŠŸèƒ½æ¸¬è©¦
- å»ºç«‹äº† `test_camera_image_fix.py` æ¸¬è©¦è…³æœ¬
- å»ºç«‹äº† `diagnose_camera_images.py` è¨ºæ–·å·¥å…·
- æ¸¬è©¦å°å—åœ°å€å’Œå…¶ä»–åœ°å€çš„ç›£æ§é»

### 2. API è³‡æ–™å“è³ªæª¢æŸ¥
- æª¢æŸ¥ URL æ ¼å¼å’Œæœ‰æ•ˆæ€§
- çµ±è¨ˆæœ‰åœ–ç‰‡çš„ç›£æ§é»æ¯”ä¾‹
- é©—è­‰åœ–ç‰‡ Content-Type

## ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ä½¿ç”¨
```
/water_cameras å°å—
```
- æœƒé¡¯ç¤ºå°å—åœ°å€çš„ç¬¬ä¸€å€‹ç›£æ§é»
- ä½¿ç”¨æŒ‰éˆ•åˆ‡æ›ä¸åŒç›£æ§é»
- å¦‚æœæœ‰åœ–ç‰‡æœƒç›´æ¥é¡¯ç¤ºåœ¨ Discord ä¸­

### 2. åŠŸèƒ½æŒ‰éˆ•
- **â—€ï¸ ä¸Šä¸€å€‹**: åˆ‡æ›åˆ°ä¸Šä¸€å€‹ç›£æ§é»
- **ğŸ”„ åˆ·æ–°**: é‡æ–°è¼‰å…¥ç•¶å‰ç›£æ§é»è³‡æ–™
- **â–¶ï¸ ä¸‹ä¸€å€‹**: åˆ‡æ›åˆ°ä¸‹ä¸€å€‹ç›£æ§é»  
- **ğŸ“ è©³ç´°è³‡è¨Š**: æŸ¥çœ‹è©³ç´°çš„ç›£æ§é»è³‡è¨Š

### 3. ç„¡åœ–ç‰‡è™•ç†
- å¦‚æœç›£æ§é»æ²’æœ‰åœ–ç‰‡ï¼Œæœƒé¡¯ç¤º "âš ï¸ æ­¤ç›£æ§é»ç›®å‰ç„¡å¯ç”¨å½±åƒ"
- ä»æœƒæä¾›ç›£æ§é»çš„åŸºæœ¬è³‡è¨Šï¼ˆä½ç½®ã€æ²³å·ã€ç‹€æ…‹ç­‰ï¼‰
- åŒ…å«åº§æ¨™ä½ç½®ä¾›åƒè€ƒ

## æ•…éšœæ’é™¤

### 1. å¦‚æœä»ç„¶çœ‹ä¸åˆ°åœ–ç‰‡
- æª¢æŸ¥ç¶²è·¯é€£ç·šæ˜¯å¦æ­£å¸¸
- éƒ¨åˆ†ç›£æ§é»å¯èƒ½æš«æ™‚ç„¡æ³•æä¾›å½±åƒ
- ä½¿ç”¨ "ğŸ”„ åˆ·æ–°" æŒ‰éˆ•é‡æ–°è¼‰å…¥
- é»æ“Š "ğŸ“ è©³ç´°è³‡è¨Š" æŸ¥çœ‹åŸå§‹å½±åƒé€£çµ

### 2. è¨ºæ–·å·¥å…·
- åŸ·è¡Œ `python diagnose_camera_images.py` æª¢æŸ¥ API ç‹€æ…‹
- åŸ·è¡Œ `python test_camera_image_fix.py` æ¸¬è©¦ä¿®å¾©æ•ˆæœ

## æŠ€è¡“ç´°ç¯€

### 1. ä¿®æ”¹çš„æª”æ¡ˆ
- `cogs/reservoir_commands.py`: ä¸»è¦çš„ç›£è¦–å™¨åŠŸèƒ½
  - `format_water_image_info()` å‡½æ•¸
  - `WaterCameraView.create_embed()` æ–¹æ³•

### 2. æ–°å¢çš„æ¸¬è©¦æª”æ¡ˆ
- `test_camera_image_fix.py`: ä¿®å¾©æ•ˆæœæ¸¬è©¦
- `diagnose_camera_images.py`: API è¨ºæ–·å·¥å…·

### 3. é—œéµæ”¹é€²é»
- URL æ ¼å¼æ¨™æº–åŒ–
- éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
- æ›¿ä»£è³‡è¨Šé¡¯ç¤º
- ç”¨æˆ¶é«”é©—æ”¹å–„

## çµè«–

æ°´åˆ©ç›£è¦–å™¨åœ–ç‰‡é¡¯ç¤ºå•é¡Œä¸»è¦æºæ–¼ API è¿”å›çš„ URL æ ¼å¼ä¸ä¸€è‡´ï¼Œä»¥åŠç¼ºä¹é©ç•¶çš„éŒ¯èª¤è™•ç†ã€‚é€šéæœ¬æ¬¡ä¿®å¾©ï¼š

1. âœ… **URL è™•ç†æ¨™æº–åŒ–** - ç¢ºä¿æ‰€æœ‰ URL æ ¼å¼æ­£ç¢º
2. âœ… **éŒ¯èª¤è™•ç†å®Œå–„** - ç„¡åœ–ç‰‡æ™‚æä¾›æ¸…æ¥šèªªæ˜
3. âœ… **è³‡è¨Šé¡¯ç¤ºå¢å¼·** - æä¾›æ›´å¤šæœ‰ç”¨çš„ç›£æ§é»è³‡è¨Š
4. âœ… **ç”¨æˆ¶é«”é©—æ”¹å–„** - åŒ…å«å¯é»æ“Šçš„åŸå§‹å½±åƒé€£çµ

ç¾åœ¨ç”¨æˆ¶å¯ä»¥ï¼š
- æ­£å¸¸æŸ¥çœ‹æœ‰åœ–ç‰‡çš„ç›£æ§é»
- äº†è§£ç„¡åœ–ç‰‡ç›£æ§é»çš„ç‹€æ…‹
- é€šéåŸå§‹é€£çµæŸ¥çœ‹å½±åƒ
- ç²å¾—è©³ç´°çš„ç›£æ§é»è³‡è¨Š

å»ºè­°å®šæœŸæª¢æŸ¥ API è³‡æ–™å“è³ªï¼Œå› ç‚ºéƒ¨åˆ†ç›£æ§é»çš„å½±åƒå¯ç”¨æ€§æœƒéš¨æ™‚é–“è®ŠåŒ–ã€‚
