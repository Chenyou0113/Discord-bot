# 功能詳細說明

## 🌡️ 氣象站翻頁功能完整指南

### 概述
氣象站翻頁功能是本機器人的核心新功能，允許用戶瀏覽全台 500+ 個自動氣象站的即時觀測資料。

### 功能特色

#### 🔍 多種查詢模式
1. **全台概況模式**
   - 指令：`/weather_station`（無參數）
   - 顯示主要縣市的氣象概況
   - 包含台北、高雄、台中等重要城市

2. **地區查詢模式**
   - 指令：`/weather_station location:台北`
   - 查詢指定地區的所有氣象站
   - 支援縣市名稱或地區名稱

3. **單一測站模式**
   - 指令：`/weather_station station_id:466920`
   - 查詢特定測站的詳細資料
   - 顯示完整的氣象參數

#### 📄 智能分頁系統
- **自動分頁**：超過 5 個測站時自動啟用翻頁
- **頁面控制**：提供上一頁、下一頁按鈕
- **頁面資訊**：顯示當前頁數和總頁數
- **邊界處理**：第一頁停用上一頁，最後一頁停用下一頁

#### 🔄 即時更新功能
- **重新整理按鈕**：可隨時獲取最新觀測資料
- **自動重新篩選**：更新後自動重新套用查詢條件
- **頁面保持**：盡可能保持在當前頁面

#### 🔐 用戶權限控制
- **專屬操作**：只有發起查詢的用戶可操作按鈕
- **權限提示**：其他用戶點擊時顯示友善提示
- **會話逾時**：5分鐘後自動停用按鈕

### 技術實現

#### WeatherStationView 類
```python
class WeatherStationView(View):
    def __init__(self, cog, user_id, stations, query_type, location):
        # 初始化翻頁系統
        self.stations_per_page = 5
        self.total_pages = 計算總頁數
        self.current_page = 0
```

#### 按鈕回調處理
- `previous_page()`: 處理上一頁請求
- `next_page()`: 處理下一頁請求  
- `refresh_data()`: 處理重新整理請求

#### 資料格式化
- `_create_current_page_embed()`: 生成當前頁面內容
- `_create_paginated_multiple_stations_embed()`: 多測站分頁格式
- `_create_paginated_overview_embed()`: 概況分頁格式

### 使用範例

#### 查詢台北地區氣象站
```
使用者: /weather_station location:台北
機器人: [顯示台北地區氣象站清單，第1/3頁]
        [◀️上一頁] [1/3] [下一頁▶️] [🔄重新整理]
```

#### 查詢特定測站
```
使用者: /weather_station station_id:466920  
機器人: [顯示台北測站詳細資料]
        🌡️ 台北 氣象觀測
        測站代碼: 466920
        ☁️ 天氣: 晴
        🌡️ 溫度: 25°C
        💧 相對濕度: 65%
        [更多詳細資訊...]
```

### 錯誤處理

#### API 異常處理
- 連線逾時自動重試
- API 回應異常時提供備用資料
- 網路錯誤時友善提示

#### 用戶操作異常
- 權限不符時的提示訊息
- 無效查詢條件的錯誤處理
- 空結果的友善回應

### 效能優化

#### 快取機制
- API 回應資料暫存
- 減少重複請求
- 提升回應速度

#### 分頁優化
- 動態載入頁面內容
- 只渲染當前頁面資料
- 減少記憶體使用

## 🔔 地震監控系統

### 自動監控機制
- 每 5 分鐘檢查一次新地震
- 自動推送到設定的通知頻道
- 支援一般地震和小區域地震

### 地震資料格式
- 震央位置和深度
- 地震規模和時間
- 各地震度分布
- 地震報告編號

## 🌤️ 天氣預報系統

### 互動式查詢
- 下拉選單選擇縣市
- 36小時詳細預報
- 包含溫度、濕度、降雨機率

### 資料來源
- 中央氣象署官方 API
- 即時更新的預報資料
- 準確的氣象資訊

---

更多技術細節請參考專案的測試檔案和原始碼註解。
