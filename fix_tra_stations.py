import re

def update_tra_stations_complete():
    # 讀取現有檔案
    with open('cogs/info_commands_fixed_v4_clean.py', 'r', encoding='utf-8') as f:
        content = f.read()
    
    # 找到 TRA_STATIONS 的開始位置
    pattern_start = r'# 台鐵車站資料按縣市分類\s*\nTRA_STATIONS = {'
    match_start = re.search(pattern_start, content)
    
    if not match_start:
        print("找不到 TRA_STATIONS 開始標記")
        return False
    
    start_pos = match_start.start()
    
    # 從 TRA_STATIONS = { 開始計算括號配對找到結束位置
    brace_pos = content.find('TRA_STATIONS = {', start_pos) + len('TRA_STATIONS = ')
    brace_count = 0
    end_pos = -1
    
    for i in range(brace_pos, len(content)):
        if content[i] == '{':
            brace_count += 1
        elif content[i] == '}':
            brace_count -= 1
            if brace_count == 0:
                end_pos = i + 1
                break
    
    if end_pos == -1:
        print("找不到 TRA_STATIONS 結束位置")
        return False
    
    print(f"找到 TRA_STATIONS 位置: {start_pos} - {end_pos}")
    
    # 新的車站資料
    new_tra_stations = '''# 台鐵車站資料按縣市分類
TRA_STATIONS = {
    "基隆市": [
        {"name": "基隆", "id": "0900"},
        {"name": "三坑", "id": "0910"},
        {"name": "八堵", "id": "0920"},
        {"name": "七堵", "id": "0930"},
        {"name": "百福", "id": "0940"},
        {"name": "海科館", "id": "7361"},
        {"name": "暖暖", "id": "7390"},
    ],
    "臺北市": [
        {"name": "南港", "id": "0980"},
        {"name": "松山", "id": "0990"},
        {"name": "臺北", "id": "1000"},
        {"name": "臺北-環島", "id": "1001"},
        {"name": "萬華", "id": "1010"},
    ],
    "新北市": [
        {"name": "五堵", "id": "0950"},
        {"name": "汐止", "id": "0960"},
        {"name": "汐科", "id": "0970"},
        {"name": "板橋", "id": "1020"},
        {"name": "浮洲", "id": "1030"},
        {"name": "樹林", "id": "1040"},
        {"name": "南樹林", "id": "1050"},
        {"name": "山佳", "id": "1060"},
        {"name": "鶯歌", "id": "1070"},
        {"name": "鳳鳴", "id": "1075"},
        {"name": "福隆", "id": "7290"},
        {"name": "貢寮", "id": "7300"},
        {"name": "雙溪", "id": "7310"},
        {"name": "牡丹", "id": "7320"},
        {"name": "三貂嶺", "id": "7330"},
        {"name": "大華", "id": "7331"},
        {"name": "十分", "id": "7332"},
        {"name": "望古", "id": "7333"},
        {"name": "嶺腳", "id": "7334"},
        {"name": "平溪", "id": "7335"},
        {"name": "菁桐", "id": "7336"},
        {"name": "猴硐", "id": "7350"},
        {"name": "瑞芳", "id": "7360"},
        {"name": "八斗子", "id": "7362"},
        {"name": "四腳亭", "id": "7380"},
    ],
    "桃園市": [
        {"name": "桃園", "id": "1080"},
        {"name": "內壢", "id": "1090"},
        {"name": "中壢", "id": "1100"},
        {"name": "埔心", "id": "1110"},
        {"name": "楊梅", "id": "1120"},
        {"name": "富岡", "id": "1130"},
        {"name": "新富", "id": "1140"},
    ],
    "新竹市": [
        {"name": "北新竹", "id": "1190"},
        {"name": "千甲", "id": "1191"},
        {"name": "新莊", "id": "1192"},
        {"name": "新竹", "id": "1210"},
        {"name": "三姓橋", "id": "1220"},
        {"name": "香山", "id": "1230"},
    ],
    "新竹縣": [
        {"name": "北湖", "id": "1150"},
        {"name": "湖口", "id": "1160"},
        {"name": "新豐", "id": "1170"},
        {"name": "竹北", "id": "1180"},
        {"name": "竹中", "id": "1193"},
        {"name": "六家", "id": "1194"},
        {"name": "上員", "id": "1201"},
        {"name": "榮華", "id": "1202"},
        {"name": "竹東", "id": "1203"},
        {"name": "橫山", "id": "1204"},
        {"name": "九讚頭", "id": "1205"},
        {"name": "合興", "id": "1206"},
        {"name": "富貴", "id": "1207"},
        {"name": "內灣", "id": "1208"},
    ],
    "苗栗縣": [
        {"name": "崎頂", "id": "1240"},
        {"name": "竹南", "id": "1250"},
        {"name": "談文", "id": "2110"},
        {"name": "大山", "id": "2120"},
        {"name": "後龍", "id": "2130"},
        {"name": "龍港", "id": "2140"},
        {"name": "白沙屯", "id": "2150"},
        {"name": "新埔", "id": "2160"},
        {"name": "通霄", "id": "2170"},
        {"name": "苑裡", "id": "2180"},
        {"name": "造橋", "id": "3140"},
        {"name": "豐富", "id": "3150"},
        {"name": "苗栗", "id": "3160"},
        {"name": "南勢", "id": "3170"},
        {"name": "銅鑼", "id": "3180"},
        {"name": "三義", "id": "3190"},
    ],
    "臺中市": [
        {"name": "日南", "id": "2190"},
        {"name": "大甲", "id": "2200"},
        {"name": "臺中港", "id": "2210"},
        {"name": "清水", "id": "2220"},
        {"name": "沙鹿", "id": "2230"},
        {"name": "龍井", "id": "2240"},
        {"name": "大肚", "id": "2250"},
        {"name": "追分", "id": "2260"},
        {"name": "泰安", "id": "3210"},
        {"name": "后里", "id": "3220"},
        {"name": "豐原", "id": "3230"},
        {"name": "栗林", "id": "3240"},
        {"name": "潭子", "id": "3250"},
        {"name": "頭家厝", "id": "3260"},
        {"name": "松竹", "id": "3270"},
        {"name": "太原", "id": "3280"},
        {"name": "精武", "id": "3290"},
        {"name": "臺中", "id": "3300"},
        {"name": "五權", "id": "3310"},
        {"name": "大慶", "id": "3320"},
        {"name": "烏日", "id": "3330"},
        {"name": "新烏日", "id": "3340"},
        {"name": "成功", "id": "3350"},
    ],
    "彰化縣": [
        {"name": "彰化", "id": "3360"},
        {"name": "花壇", "id": "3370"},
        {"name": "大村", "id": "3380"},
        {"name": "員林", "id": "3390"},
        {"name": "永靖", "id": "3400"},
        {"name": "社頭", "id": "3410"},
        {"name": "田中", "id": "3420"},
        {"name": "二水", "id": "3430"},
        {"name": "源泉", "id": "3431"},
    ],
    "南投縣": [
        {"name": "濁水", "id": "3432"},
        {"name": "龍泉", "id": "3433"},
        {"name": "集集", "id": "3434"},
        {"name": "水里", "id": "3435"},
        {"name": "車埕", "id": "3436"},
    ],
    "雲林縣": [
        {"name": "林內", "id": "3450"},
        {"name": "石榴", "id": "3460"},
        {"name": "斗六", "id": "3470"},
        {"name": "斗南", "id": "3480"},
        {"name": "石龜", "id": "3490"},
    ],
    "嘉義市": [
        {"name": "嘉北", "id": "4070"},
        {"name": "嘉義", "id": "4080"},
    ],
    "嘉義縣": [
        {"name": "大林", "id": "4050"},
        {"name": "民雄", "id": "4060"},
        {"name": "水上", "id": "4090"},
        {"name": "南靖", "id": "4100"},
    ],
    "臺南市": [
        {"name": "後壁", "id": "4110"},
        {"name": "新營", "id": "4120"},
        {"name": "柳營", "id": "4130"},
        {"name": "林鳳營", "id": "4140"},
        {"name": "隆田", "id": "4150"},
        {"name": "拔林", "id": "4160"},
        {"name": "善化", "id": "4170"},
        {"name": "南科", "id": "4180"},
        {"name": "新市", "id": "4190"},
        {"name": "永康", "id": "4200"},
        {"name": "大橋", "id": "4210"},
        {"name": "臺南", "id": "4220"},
        {"name": "保安", "id": "4250"},
        {"name": "仁德", "id": "4260"},
        {"name": "中洲", "id": "4270"},
        {"name": "長榮大學", "id": "4271"},
        {"name": "沙崙", "id": "4272"},
    ],
    "高雄市": [
        {"name": "大湖", "id": "4290"},
        {"name": "路竹", "id": "4300"},
        {"name": "岡山", "id": "4310"},
        {"name": "橋頭", "id": "4320"},
        {"name": "楠梓", "id": "4330"},
        {"name": "新左營", "id": "4340"},
        {"name": "左營", "id": "4350"},
        {"name": "內惟", "id": "4360"},
        {"name": "美術館", "id": "4370"},
        {"name": "鼓山", "id": "4380"},
        {"name": "三塊厝", "id": "4390"},
        {"name": "高雄", "id": "4400"},
        {"name": "民族", "id": "4410"},
        {"name": "科工館", "id": "4420"},
        {"name": "正義", "id": "4430"},
        {"name": "鳳山", "id": "4440"},
        {"name": "後庄", "id": "4450"},
        {"name": "九曲堂", "id": "4460"},
    ],
    "屏東縣": [
        {"name": "六塊厝", "id": "4470"},
        {"name": "屏東", "id": "5000"},
        {"name": "歸來", "id": "5010"},
        {"name": "麟洛", "id": "5020"},
        {"name": "西勢", "id": "5030"},
        {"name": "竹田", "id": "5040"},
        {"name": "潮州", "id": "5050"},
        {"name": "崁頂", "id": "5060"},
        {"name": "南州", "id": "5070"},
        {"name": "鎮安", "id": "5080"},
        {"name": "林邊", "id": "5090"},
        {"name": "佳冬", "id": "5100"},
        {"name": "東海", "id": "5110"},
        {"name": "枋寮", "id": "5120"},
        {"name": "加祿", "id": "5130"},
        {"name": "內獅", "id": "5140"},
        {"name": "枋山", "id": "5160"},
        {"name": "枋野", "id": "5170"},
        {"name": "南方小站", "id": "5998"},
        {"name": "潮州基地", "id": "5999"},
    ],
    "臺東縣": [
        {"name": "大武", "id": "5190"},
        {"name": "瀧溪", "id": "5200"},
        {"name": "金崙", "id": "5210"},
        {"name": "太麻里", "id": "5220"},
        {"name": "知本", "id": "5230"},
        {"name": "康樂", "id": "5240"},
        {"name": "臺東", "id": "6000"},
        {"name": "山里", "id": "6010"},
        {"name": "鹿野", "id": "6020"},
        {"name": "瑞源", "id": "6030"},
        {"name": "瑞和", "id": "6040"},
        {"name": "關山", "id": "6050"},
        {"name": "海端", "id": "6060"},
        {"name": "池上", "id": "6070"},
    ],
    "花蓮縣": [
        {"name": "富里", "id": "6080"},
        {"name": "東竹", "id": "6090"},
        {"name": "東里", "id": "6100"},
        {"name": "玉里", "id": "6110"},
        {"name": "三民", "id": "6120"},
        {"name": "瑞穗", "id": "6130"},
        {"name": "富源", "id": "6140"},
        {"name": "大富", "id": "6150"},
        {"name": "光復", "id": "6160"},
        {"name": "萬榮", "id": "6170"},
        {"name": "鳳林", "id": "6180"},
        {"name": "南平", "id": "6190"},
        {"name": "林榮新光", "id": "6200"},
        {"name": "豐田", "id": "6210"},
        {"name": "壽豐", "id": "6220"},
        {"name": "平和", "id": "6230"},
        {"name": "志學", "id": "6240"},
        {"name": "吉安", "id": "6250"},
        {"name": "花蓮", "id": "7000"},
        {"name": "北埔", "id": "7010"},
        {"name": "景美", "id": "7020"},
        {"name": "新城", "id": "7030"},
        {"name": "崇德", "id": "7040"},
        {"name": "和仁", "id": "7050"},
        {"name": "和平", "id": "7060"},
    ],
    "宜蘭縣": [
        {"name": "漢本", "id": "7070"},
        {"name": "武塔", "id": "7080"},
        {"name": "南澳", "id": "7090"},
        {"name": "東澳", "id": "7100"},
        {"name": "永樂", "id": "7110"},
        {"name": "蘇澳", "id": "7120"},
        {"name": "蘇澳新", "id": "7130"},
        {"name": "新馬", "id": "7140"},
        {"name": "冬山", "id": "7150"},
        {"name": "羅東", "id": "7160"},
        {"name": "中里", "id": "7170"},
        {"name": "二結", "id": "7180"},
        {"name": "宜蘭", "id": "7190"},
        {"name": "四城", "id": "7200"},
        {"name": "礁溪", "id": "7210"},
        {"name": "頂埔", "id": "7220"},
        {"name": "頭城", "id": "7230"},
        {"name": "外澳", "id": "7240"},
        {"name": "龜山", "id": "7250"},
        {"name": "大溪", "id": "7260"},
        {"name": "大里", "id": "7270"},
        {"name": "石城", "id": "7280"},
    ]
}'''
    
    # 建立新的檔案內容
    new_content = content[:start_pos] + new_tra_stations + content[end_pos:]
    
    # 寫入檔案
    with open('cogs/info_commands_fixed_v4_clean.py', 'w', encoding='utf-8') as f:
        f.write(new_content)
    
    print("✅ 完成所有車站資料更新！")
    print(f"總計更新了 244 個車站，涵蓋 19 個縣市")
    print("重要更正：志學站 ID 已從錯誤的 2560 更正為正確的 6240")
    
    return True

if __name__ == "__main__":
    success = update_tra_stations_complete()
    if success:
        print("\n🚄 台鐵車站資料更新成功完成！")
    else:
        print("\n❌ 更新失敗，請檢查錯誤信息")
