# 台鐵/高鐵新聞顯示優化說明

## 📋 更新內容

### ✨ 主要改進
1. **移除 HTML 標籤** - 清理原始數據中的 HTML 代碼
2. **移除程式碼標記** - 過濾 ``` 和 ` 等程式碼標記
3. **顯示完整連結** - 以純文字格式顯示公告 URL
4. **增加字數限制** - 從 200 字提升到 300 字
5. **美化格式** - 使用 ** 加粗重要欄位

## 🚄 高鐵新聞 (`/thsr_news`)

### 顯示格式
```
📌 第 X 則 - [標題]

[純文字內容，最多300字]...

🕒 **發布時間:** YYYY-MM-DD HH:MM:SS
🔗 **公告連結:** https://...
```

### 內容清理
- ✅ 移除所有 HTML 標籤 (`<div>`, `<p>`, `<br>` 等)
- ✅ 移除程式碼區塊 (```)
- ✅ 移除行內程式碼 (`)
- ✅ 壓縮多餘空白
- ✅ 保留純文字內容

### 連結顯示
- **舊格式**: `🔗 [查看完整新聞](url)` (Discord 超連結格式)
- **新格式**: `🔗 **公告連結:** url` (純文字 URL，可直接複製)

## 🚆 台鐵新聞 (`/tra_news`)

### 顯示格式
```
📌 第 X 則 - [標題]

[純文字內容，最多300字]...

🕒 **發布時間:** YYYY-MM-DD HH:MM:SS
🔗 **公告連結:** https://...
```

### 內容清理
同高鐵新聞,包含:
- ✅ HTML 標籤移除
- ✅ 程式碼標記移除
- ✅ 空白壓縮
- ✅ 純文字展示

### 額外功能
- ✅ 過濾人事公告 (面試、甄選、錄取、徵才等 15 個關鍵字)
- ✅ 時間排序 (最新在前)
- ✅ 分頁顯示 (每頁 1 則)

## 🔧 技術實現

### HTML 清理正則表達式
```python
import re

# 移除 HTML 標籤
description = re.sub(r'<[^>]+>', '', description)

# 移除多餘空白
description = re.sub(r'\s+', ' ', description).strip()

# 移除程式碼標記
description = re.sub(r'```[\s\S]*?```', '', description)
description = re.sub(r'`[^`]*`', '', description)
```

### 格式化範例

**處理前:**
```
<div class="news-content">
<p>台灣高鐵公告</p>
<br>
```python
code_example = "test"
```
<strong>重要通知</strong>
</div>
```

**處理後:**
```
台灣高鐵公告 重要通知
```

## 📊 對比表

| 項目 | 舊版本 | 新版本 |
|------|--------|--------|
| HTML 標籤 | ❌ 顯示 | ✅ 清除 |
| 程式碼 | ❌ 顯示 | ✅ 清除 |
| 字數限制 | 200 字 | 300 字 |
| 連結格式 | 超連結 | 純文字 URL |
| 發布時間 | 普通文字 | **加粗** |
| 連結標籤 | 普通文字 | **加粗** |

## ✅ 使用方式

### 台鐵新聞
```
/tra_news
```
- 自動過濾人事公告
- 只顯示純文字營運資訊
- 附帶公告完整連結

### 高鐵新聞
```
/thsr_news
```
- 清理 HTML 和程式碼
- 純文字顯示
- 附帶公告完整連結

## 🎯 效果

### 優點
- ✅ 內容更清晰易讀
- ✅ 不會出現 HTML 標籤混亂
- ✅ 不會顯示程式碼片段
- ✅ URL 可直接複製使用
- ✅ 格式統一美觀

### 使用者體驗
- ✨ 更專業的資訊展示
- ✨ 更容易閱讀理解
- ✨ 更方便複製連結
- ✨ 更符合 Discord 訊息風格

## 📝 更新記錄
- **2025-10-03 01:05**: 
  - 新增 HTML 標籤清理功能
  - 新增程式碼標記移除
  - 調整連結顯示為純文字格式
  - 字數限制從 200 提升到 300
  - 發布時間和連結標籤加粗顯示

## 🔍 注意事項
1. 正則表達式會移除所有 `<>` 包圍的內容
2. 三個反引號包圍的程式碼區塊會被完全移除
3. 單個反引號的行內程式碼也會被移除
4. 連續的空白字元會被壓縮為單一空格
5. URL 以純文字顯示,在 Discord 中會自動變成可點擊的超連結

## 📞 維護說明
如需調整清理邏輯,請修改:
- **台鐵新聞**: `cogs/info_commands_fixed_v4_clean.py` 
  - `TRANewsPaginationView.create_embed()` 方法 (約 6363-6410 行)
- **高鐵新聞**: `cogs/info_commands_fixed_v4_clean.py`
  - `THSRNewsPaginationView.create_embed()` 方法 (約 6580-6627 行)
